USE CSE_3A_193;

CREATE TABLE STUDENT_MASTER_L15 (
    RNO INT PRIMARY KEY,
    NAME VARCHAR(50),

    --3. Enter the default value as ‘General’ in branch to all new records IF no other value is specified. 
    BRANCH VARCHAR(10) DEFAULT 'GENERAL',

    --1. Do not allow SPI more than 10 
    SPI DECIMAL(4,2) CHECK (SPI<=10 AND SPI>=0),

    --2. Do not allow Bklog less than 0. 
    BKLOG INT CHECK (BKLOG>=0)

);

INSERT INTO STUDENT_MASTER_L15 VALUES (101, 'RAJU', 'CE', 8.80, 0);
INSERT INTO STUDENT_MASTER_L15 VALUES (102, 'AMIT', 'CE', 2.20, 3);
INSERT INTO STUDENT_MASTER_L15 VALUES (103, 'SANJAY', 'ME', 1.50, 6);
INSERT INTO STUDENT_MASTER_L15 VALUES (104, 'NEHA', 'EC', 7.65, 0);
INSERT INTO STUDENT_MASTER_L15 VALUES (105, 'MEERA', 'EE', 5.52, 2);
INSERT INTO STUDENT_MASTER_L15 VALUES (106, 'MAHESH', NULL, 4.50, 3);

SELECT * FROM STUDENT_MASTER_L15;

--Part – A: 

--4. Try to update SPI of Raju from 8.80 to 12. 
UPDATE STUDENT_MASTER_L15
SET SPI=12
WHERE NAME='RAJU';

--5. Try to update Bklog of Neha from 0 to -1 
UPDATE STUDENT_MASTER_L15
SET BKLOG=-1
WHERE NAME='NEHA'


--Part – B: Create table as per following schema with proper validation and try to insert data which violate your 
--validation. 

--1. Emp_details(Eid, Ename, Did, Cid, Salary, Experience) 
CREATE TABLE EMP_DETAILS(
    EID INT PRIMARY KEY NOT NULL,
    ENAME VARCHAR(25),
    DID INT,
    CID INT,
    SALARY INT CHECK (SALARY>0),
    EXPERIENCE INT CHECK (EXPERIENCE>=0),
    FOREIGN KEY (Did) REFERENCES DEPT_DETAILS(Did),
    FOREIGN KEY (Cid) REFERENCES CITY_DETAILS(Cid)
);

--Dept_details(Did, Dname) 
CREATE TABLE DEPT_DETAILS(
    DID INT PRIMARY KEY,
    DNAME VARCHAR(10) NOT NULL UNIQUE
);

--City_details(Cid, Cname)
CREATE TABLE CITY_DETAILS(
    CID INT PRIMARY KEY,
    CNAME VARCHAR(25) NOT NULL
);

INSERT INTO DEPT_DETAILS VALUES
(1, 'HR'), 
(2, 'IT'), 
(3, 'Finance');

INSERT INTO CITY_DETAILS VALUES 
(101, 'Mumbai'), 
(102, 'Delhi'), 
(103, 'Ahmedabad');

INSERT INTO Emp_details VALUES 
(1, 'Amit', 1, 101, 50000, 5),
(2, 'Rina', 2, 102, 60000, 4);

--INSERTING INVALID RECORDS
INSERT INTO EMP_DETAILS VALUES (3,'NOOB',3,103,-45000,0);
INSERT INTO CITY_DETAILS VALUES (104,NULL);
INSERT INTO DEPT_DETAILS VALUES (4,NULL);


--Part – C: Create table as per following schema with proper validation and try to insert data which violate your 
--validation. 

--1. Emp_info(Eid, Ename, Did, Cid, Salary, Experience) 
CREATE TABLE EMP_INFO(
    EID INT PRIMARY KEY,    ENAME VARCHAR(50),  DID INT,    CID INT,    SALARY INT,    EXPERIENCE INT,     FOREIGN KEY (DID) REFERENCES DEPT_INFO(DID),    FOREIGN KEY (CID) REFERENCES CITY_INFO(CID)
);

--Dept_info(Did, Dname)
CREATE TABLE DEPT_INFO(
    DID INT PRIMARY KEY,    DNAME VARCHAR(50)
);

--City_info(Cid, Cname, Did)) 
CREATE TABLE CITY_INFO(
    CID INT PRIMARY KEY,    CNAME VARCHAR(50),    DID INT,    FOREIGN KEY (DID) REFERENCES DISTRICT(DID)
);

--District(Did, Dname, Sid)
CREATE TABLE DISTRICT(
    DID INT PRIMARY KEY,    DIS_NAME VARCHAR(50),    SID INT,    FOREIGN KEY (SID) REFERENCES STATE(SID)
);

--State(Sid, Sname, Cid) 
CREATE TABLE STATE(
    SID INT PRIMARY KEY,    SNAME VARCHAR(50),    CID INT,    FOREIGN KEY (CID) REFERENCES COUNTRY(CID)
);

--Country(Cid, Cname) 
CREATE TABLE COUNTRY(
    CID INT PRIMARY KEY,    CNAME VARCHAR(50)
);

SELECT * FROM EMP_INFO;
SELECT * FROM DEPT_INFO;
SELECT * FROM CITY_INFO;
SELECT * FROM DISTRICT;
SELECT * FROM STATE;
SELECT * FROM COUNTRY;

--2. Insert 5 records in each table.

INSERT INTO COUNTRY VALUES (1, 'INDIA'),(2, 'USA'),(3, 'UK'),(4, 'CANADA'),(5, 'AUSTRALIA');

INSERT INTO STATE VALUES (11, 'MAHARASHTRA', 1),(12, 'GUJARAT', 1),(13, 'CALIFORNIA', 2),(14, 'ONTARIO', 4),(15, 'SYDNEY', 5);

INSERT INTO DISTRICT VALUES (21, 'MUMBAI DISTRICT', 11),(22, 'AHMEDABAD DISTRICT', 12),(23, 'LOS ANGELES DISTRICT', 13),(24, 'TORONTO DISTRICT', 14),(25, 'SYDNEY DISTRICT', 15);

INSERT INTO CITY_INFO VALUES (201, 'MUMBAI', 21),(202, 'AHMEDABAD', 22),(203, 'LOS ANGELES', 23),(204, 'TORONTO', 24),(205, 'SYDNEY', 25);

INSERT INTO DEPT_INFO VALUES (101, 'HR'),(102, 'IT'),(103, 'FINANCE'),(104, 'MARKETING'),(105, 'OPERATIONS');

INSERT INTO EMP_INFO VALUES (301, 'AMIT', 101, 201, 50000, 5),(302, 'RINA', 102, 202, 60000, 4),(303, 'JOHN', 103, 203, 75000, 6),(304, 'SOFIA', 104, 204, 80000, 7),(305, 'RAJ', 105, 205, 55000, 3);

--3. Display employeename, departmentname, Salary, Experience, City, District, State and country of all 
--employees.

SELECT ENAME AS[EMP_NAME],
       dept.DNAME AS [DEPT_NAME],
       SALARY AS [SALARY],
       EXPERIENCE AS [EXPERIENCE],
       city.CNAME AS [CITY],
       dept.DNAME AS [DISTRICT],
       SNAME AS [STATE],
       c.CNAME AS [COUNTRY]
FROM EMP_INFO e
JOIN DEPT_INFO dept ON e.DID = dept.DID
JOIN CITY_INFO city ON e.CID = city.CID
JOIN DISTRICT d ON city.DID = d.DID
JOIN STATE s ON s.SID = d.SID
JOIN COUNTRY c ON s.CID = c.CID;
